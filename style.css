/* ==========================================================================
   1. VARIABLES Y CONFIGURACIÓN BASE
   ========================================================================== */
:root {
    --bg-dark: #0c0c0c;
    --header-bg: #181818;
    --accent: #00fbff;
    --border: #2a2a2a;
    --sidebar-w: 70px;
    --footer-h: 70px; /* Reducido ligeramente para optimizar pantalla */
    --header-h: 50px;
}

body {
    margin: 0; 
    background: var(--bg-dark); 
    color: white;
    font-family: 'Segoe UI', sans-serif; 
    height: 100vh;
    display: flex; 
    flex-direction: column; 
    overflow: hidden;
}

/* ==========================================================================
   2. ESTRUCTURA PRINCIPAL (HEADER, SIDEBAR, DASHBOARD)
   ========================================================================== */
#main-header {
    height: var(--header-h); 
    background: var(--header-bg);
    display: flex; 
    align-items: center; 
    justify-content: space-between;
    padding: 0 20px; 
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
}

#app-container { 
    flex-grow: 1; 
    display: flex; 
    overflow: hidden; 
}

#sidebar {
    width: 65px; /* Ancho fijo y delgado */
    background: #111;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 10px;
    flex-shrink: 0;
}

#main-dashboard { 
    flex-grow: 1; 
    display: grid; 
    gap: 8px; 
    padding: 10px; 
    height: 100%;
}

/* ==========================================================================
   3. PANELES Y CANVAS (SISTEMA DE CAPAS)
   ========================================================================== */
.panel {
    background: #000;
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    position: relative;
    min-height: 0;
}

.panel header { 
    background: #1a1a1a; 
    font-size: 10px; 
    padding: 4px; 
    text-align: center; 
    color: #888; 
    text-transform: uppercase;
}

.canvas-wrapper, #canvasContainer {
    position: relative;
    flex-grow: 1;
    overflow: hidden; /* CRUCIAL: Recorta el dibujo que se sale */
}

canvas { 
    width: 100%; 
    height: 100%; 
    display: block; 
    touch-action: none; /* Necesario para zoom táctil */
}

/* ==========================================================================
   4. CONTROLES FLOTANTES (GRILLAS Y RESET)
   ========================================================================== */
.panel-controls {
    position: absolute;
    bottom: 30px;
    right: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(15, 15, 15, 0.85);
    padding: 6px 10px;
    border-radius: 8px;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 251, 255, 0.2);
    z-index: 100;
}

.grid-inputs {
    display: flex;
    gap: 4px;
    border-right: 1px solid #444;
    padding-right: 8px;
}

.grid-inputs input {
    width: 45px;
    height: 25px;
    background: #000;
    border: 1px solid #333;
    color: var(--accent);
    text-align: center;
    font-size: 11px;
    border-radius: 4px;
}

.btn-reset-mini {
    width: 25px;
    height: 25px;
    background: transparent;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: 0.2s;
}

.btn-reset-mini:hover {
    background: rgba(0, 251, 255, 0.2);
    color: var(--accent);
}

/* ==========================================================================
   5. COMPONENTES ESPECÍFICOS (PK, HUD, FOOTER)
   ========================================================================== */
.km-wrapper { display: flex; gap: 8px; align-items: center; }

.km-box {
    background: #000;
    border: 1px solid var(--border);
    border-radius: 4px;
    height: 36px;
    display: flex;
    align-items: center;
    padding: 0 12px;
}

#kmInput {
    background: transparent;
    border: none;
    color: var(--accent);
    font-size: 18px;
    font-weight: bold;
    font-family: monospace;
    width: 140px;
    outline: none;
    text-align: center;
}

#hud { 
    position: absolute; 
    top: 20px; /* Bajamos un poco para que no tape el header del panel */
    right: 15px; 
    background: rgba(0,0,0,0.85); 
    border: 1px solid var(--accent); 
    padding: 8px; 
    border-radius: 4px; 
    font-family: monospace; 
    z-index: 50; /* Por debajo de los controles pero sobre el canvas */
    font-size: 13px;
    pointer-events: none; /* No estorba al clic */
}

#main-footer {
    height: auto; 
    min-height: 70px; /* Asegura un alto mínimo */
    background: #0a0a0a;
    border-top: 1px solid #222;
    padding: 10px 15px 5px 15px; 
    display: flex;
    flex-direction: column; /* Cambiado a columna para que el safe area baje */
    justify-content: center;
    position: relative;
    z-index: 1000;
}

.mobile-safe-area {
    height: 25px; /* Este es el "espacio muerto" que pediste */
    width: 100%;
}

.slider-wrapper {
    width: 100%;
    padding: 0 10px; /* Un pequeño margen para que el círculo no se corte en los extremos */
    box-sizing: border-box;
}

input[type=range] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    background: transparent;
    height: 30px; /* Área táctil dedicada */
    margin: 0;
}

/* El "camino" de la barra */
input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: 6px;
    background: #1a1a1a;
    border-radius: 3px;
    border: 1px solid #333;
}

/* El círculo (Thumb) - Más grande para tablets */
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    height: 22px;
    width: 22px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    margin-top: -9px; /* Centrado en el track */
    box-shadow: 0 0 15px rgba(0, 251, 255, 0.4);
    border: 2px solid #000;
}

/* ==========================================================================
   6. LAYOUTS DINÁMICOS Y PESTAÑAS
   ========================================================================== */
.tab-btn {
    background: transparent;
    border: none;
    color: #555;
    width: 100%;
    padding: 12px 0;
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.tab-btn i, .tab-btn span {
    font-size: 9px; /* Texto pequeño y minimalista */
    font-weight: bold;
    margin-top: 5px;
    text-transform: uppercase;
}

.tab-btn.active {
    color: var(--accent);
    background: rgba(0, 251, 255, 0.05);
    border-left: 2px solid var(--accent);
}

/* Layout Lógica */
.layout-seccion #panel-planta, .layout-seccion #panel-perfil { display: none; }
.layout-planta #panel-seccion, .layout-planta #panel-perfil { display: none; }
.layout-perfil #panel-planta, .layout-perfil #panel-seccion { display: none; }

.layout-multi { 
    grid-template-columns: 1fr 1fr; 
    grid-template-rows: 1fr 2fr; 
}
.layout-multi #panel-seccion { grid-column: span 2; }

/* ==========================================================================
   OPTIMIZACIÓN PARA MÓVILES (IPHONE / PANTALLAS PEQUEÑAS)
   ========================================================================== */

/* Cuando la pantalla es pequeña (Móvil) */
@media (max-width: 600px) {
    :root {
        --sidebar-w: 55px;   /* Sidebar más angosto */
        --header-h: 40px;    /* Header más bajo */
        --footer-h: 60px;    /* Footer más compacto */
    }

    .brand { font-size: 14px; }
    .km-box { height: 30px; padding: 0 8px; }
    #kmInput { font-size: 14px; width: 100px; }

    /* Hacer que los controles de grilla sean más pequeños para que no se corten */
    .panel-controls {
        bottom: 10px;
        right: 10px;
        padding: 4px 6px;
        scale: 0.8; /* Escalamos el grupo completo un 20% */
        transform-origin: bottom right;
    }

    /* Subir el texto de las coordenadas (PK) para que no choque con el slider */
    #main-footer {
        padding: 0 10px 10px 10px;
    }
}

/* Cuando el celular está en posición VERTICAL (Retrato) */
@media (max-width: 600px) and (orientation: portrait) {
    #main-dashboard {
        padding: 5px;
        gap: 4px;
    }
    
    /* En vertical, el slider necesita estar lo más abajo posible */
    .mobile-safe-area {
        height: 10px; 
    }
}